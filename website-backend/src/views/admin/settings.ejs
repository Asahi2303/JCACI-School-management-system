<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Settings - Admin Dashboard</title>
  <link rel="stylesheet" href="/css/admin-dashboard.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
  <style>
    .settings-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 30px;
    }

    .settings-section {
      background: var(--surface);
      padding: 30px;
      border-radius: 12px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border-color);
    }

    .settings-section h3 {
      color: var(--primary-dark);
      margin-bottom: 20px;
      font-size: 20px;
      font-weight: 600;
      border-bottom: 2px solid var(--primary);
      padding-bottom: 10px;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .form-group label {
      font-weight: 600;
      color: var(--primary-dark);
      font-size: 14px;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      padding: 12px;
      border: 2px solid var(--border-color);
      border-radius: 8px;
      font-size: 14px;
      background: var(--surface);
      color: var(--text);
      transition: border-color 0.3s ease, background 0.3s ease;
    }

    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: var(--primary);
    }

    .form-group textarea {
      resize: vertical;
      min-height: 100px;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 15px 0;
    }

    .checkbox-group input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: var(--primary);
    }

    .checkbox-group label {
      margin-bottom: 0;
      cursor: pointer;
    }

    .color-input {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .color-input input[type="color"] {
      width: 50px;
      height: 40px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    .submit-btn {
      background: var(--primary);
      color: #fff;
      padding: 14px 28px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin-top: 20px;
    }

    .submit-btn:hover {
      background: var(--primary-dark);
    }

    .settings-info {
      background: var(--gradient-soft-start);
      color: var(--primary-dark);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      border-left: 4px solid var(--primary);
    }

    .settings-info svg {
      vertical-align: middle;
      margin-right: 8px;
    }

    .danger-zone {
      border: 2px solid var(--danger);
      background: var(--danger-bg);
      padding: 20px;
      border-radius: 8px;
      margin-top: 30px;
    }

    .danger-zone h4 {
      color: var(--danger);
      margin-bottom: 15px;
      font-size: 18px;
    }

    .danger-btn {
      background: var(--danger);
      color: #fff;
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .danger-btn:hover {
      background: #d32f2f;
    }

    .current-values {
      background: var(--surface);
      border: 1px solid var(--border-color);
      padding: 15px;
      border-radius: 8px;
      margin-top: 10px;
    }

    .current-values h5 {
      margin: 0 0 10px 0;
      color: var(--text);
      font-size: 14px;
      font-weight: 600;
    }

    .current-values p {
      margin: 5px 0;
      color: var(--muted);
      font-size: 13px;
    }

    @media (max-width: 768px) {
      .settings-container {
        grid-template-columns: 1fr;
      }

      .form-row {
        grid-template-columns: 1fr;
      }
    }
  </style>
  <script>
    (function() {
      try {
        const stored = localStorage.getItem('admin-theme');
        const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const theme = stored || (systemDark ? 'dark' : 'light');
        if (theme === 'dark') {
          document.documentElement.setAttribute('data-theme', 'dark');
        }
      } catch(e) { /* ignore */ }
    })();
  </script>
</head>
<body>
  <!-- Admin Header -->
  <header class="admin-header">
    <nav class="admin-nav">
      <div class="admin-brand">
        <div class="logo-wrapper">
          <img src="/images/brand-logo.png" alt="Site Logo" class="admin-logo" loading="lazy" />
        </div>
        <h1>Admin Portal</h1>
      </div>
      <div class="admin-nav-links">
        <button type="button" id="themeToggle" class="theme-toggle" aria-pressed="false" style="margin-right:.5rem;">
          <span class="toggle-label-light">üåû</span>
            <span class="toggle-label-dark" style="display:none;">üåô</span>
            <span class="sr-only">Toggle theme</span>
        </button>
        <a href="/admin">Dashboard</a>
        <a href="/admin/facilities">Facilities</a>
        <a href="/admin/testimonials">Testimonials</a>
        <a href="/admin/settings" aria-current="true">Settings</a>
        <form action="/admin/logout" method="POST" style="display:inline;">
          <button type="submit" class="logout-btn">Logout</button>
        </form>
      </div>
    </nav>
  </header>
  <script>
    (function () {
      const btn = document.getElementById('themeToggle');
      if (!btn) return;
      const root = document.documentElement;
      function getTheme() {
        return root.getAttribute('data-theme') === 'dark' ? 'dark' : 'light';
      }
      function applyLabel(theme) {
        const isDark = theme === 'dark';
        btn.setAttribute('aria-pressed', String(isDark));
        const l = btn.querySelector('.toggle-label-light');
        const d = btn.querySelector('.toggle-label-dark');
        if (l && d) {
          l.style.display = isDark ? 'none' : 'inline';
          d.style.display = isDark ? 'inline' : 'none';
        }
      }
      applyLabel(getTheme());
      btn.addEventListener('click', () => {
        const current = getTheme();
        const next = current === 'dark' ? 'light' : 'dark';
        if (next === 'dark') {
          root.setAttribute('data-theme', 'dark');
        } else {
          root.removeAttribute('data-theme');
        }
        try {
          localStorage.setItem('admin-theme', next);
        } catch (e) {}
        applyLabel(next);
      });
    })();
  </script>

  <!-- Main Content -->
  <main class="admin-main">
    <div class="admin-hero">
      <h2>Website Settings</h2>
      <p>Configure your website settings and preferences</p>
    </div>

    <div class="settings-info">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="12" cy="12" r="10" stroke="#4caf50" stroke-width="2"/>
        <path d="M9 12l2 2 4-4" stroke="#4caf50" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      Changes are saved automatically. Current values are shown below each setting.
    </div>

    <% if (typeof query !== 'undefined' && query.success) { %>
      <div class="settings-info" style="background:#e8f5e9;border-left-color:#2e7d32;">‚úÖ <%= query.success %></div>
    <% } %>
    <% if (typeof query !== 'undefined' && query.error) { %>
      <div class="settings-info" style="background:#ffebee;border-left-color:#f44336;color:#c62828;">‚ùå <%= query.error %></div>
    <% } %>

    <div class="settings-container">
      <!-- SEO Settings -->
      <div class="settings-section">
        <h3>SEO Settings</h3>
        <form action="/admin/settings/seo" method="POST">
          <div class="form-group">
            <label for="metaTitle">Meta Title</label>
            <input type="text" id="metaTitle" name="metaTitle" value="<%= (settings.seo && settings.seo.metaTitle) || '' %>" required>
            <div class="current-values">
              <h5>Current:</h5>
              <p><%= (settings.seo && settings.seo.metaTitle) || 'Not set' %></p>
            </div>
          </div>

          <div class="form-group">
            <label for="metaDescription">Meta Description</label>
            <textarea id="metaDescription" name="metaDescription"><%= (settings.seo && settings.seo.metaDescription) || '' %></textarea>
            <div class="current-values">
              <h5>Current:</h5>
              <p><%= (settings.seo && settings.seo.metaDescription) || 'Not set' %></p>
            </div>
          </div>

          <div class="form-group">
            <label for="keywords">Keywords (comma-separated)</label>
            <input type="text" id="keywords" name="keywords" value="<%= (settings.seo && settings.seo.keywords) || '' %>">
            <div class="current-values">
              <h5>Current:</h5>
              <p><%= (settings.seo && settings.seo.keywords) || 'None' %></p>
            </div>
          </div>

          <button type="submit" class="submit-btn">Save SEO Settings</button>
        </form>
      </div>

      <!-- System Settings -->
      <div class="settings-section">
        <h3>System Settings</h3>
        <form action="/admin/settings/system" method="POST">
          <div class="form-group">
            <label for="maxFileSize">Maximum File Upload Size (MB)</label>
            <input type="number" id="maxFileSize" name="maxFileSize" value="<%= (settings.system && settings.system.maxFileSize) || 5 %>" min="1" max="50">
            <div class="current-values">
              <h5>Current:</h5>
              <style>
                .settings-container { display:grid; grid-template-columns: repeat(auto-fit,minmax(400px,1fr)); gap:30px; }
                .settings-section { background: var(--surface); padding:30px; border-radius:12px; box-shadow: var(--shadow); border:1px solid var(--border-color); }
                .settings-section h3 { color: var(--primary-dark); margin:0 0 20px; font-size:20px; font-weight:600; border-bottom:2px solid var(--primary); padding-bottom:10px; }
                .form-row { display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-bottom:20px; }
                .form-group { display:flex; flex-direction:column; gap:8px; }
                .form-group label { font-weight:600; color: var(--primary-dark); font-size:14px; }
                .form-group input, .form-group textarea, .form-group select { padding:12px; border:2px solid var(--border-color); border-radius:8px; font-size:14px; transition:border-color .3s ease, background .3s ease; background: var(--surface); color: var(--text); }
                .form-group input:focus, .form-group textarea:focus, .form-group select:focus { outline:none; border-color: var(--primary); }
                .form-group textarea { resize:vertical; min-height:100px; }
                .checkbox-group { display:flex; align-items:center; gap:10px; margin:15px 0; }
                .checkbox-group input[type="checkbox"] { width:18px; height:18px; accent-color: var(--primary); }
                .checkbox-group label { margin-bottom:0; cursor:pointer; }
                .color-input { display:flex; align-items:center; gap:10px; }
                .color-input input[type="color"] { width:50px; height:40px; border:none; border-radius:8px; cursor:pointer; }
                .submit-btn { background: var(--primary); color:#fff; padding:14px 28px; border:none; border-radius:8px; font-size:16px; font-weight:600; cursor:pointer; transition:background-color .3s ease; margin-top:20px; }
                .submit-btn:hover { background: var(--primary-dark); }
                .settings-info { background: var(--gradient-soft-start); color: var(--primary-dark); padding:15px; border-radius:8px; margin-bottom:20px; border-left:4px solid var(--primary); }
                .settings-info svg { vertical-align:middle; margin-right:8px; }
                .danger-zone { border:2px solid var(--danger); background: var(--danger-bg); padding:20px; border-radius:8px; margin-top:30px; }
                .danger-zone h4 { color: var(--danger); margin:0 0 15px; font-size:18px; }
                .danger-btn { background: var(--danger); color:#fff; padding:12px 24px; border:none; border-radius:6px; font-weight:600; cursor:pointer; transition:background-color .3s ease; }
                .danger-btn:hover { background:#c53030; }
                .current-values { background: var(--surface); border:1px solid var(--border-color); padding:15px; border-radius:8px; margin-top:10px; }
                .current-values h5 { margin:0 0 10px; color: var(--text); font-size:14px; font-weight:600; }
                .current-values p { margin:5px 0; color: var(--muted); font-size:13px; }
                @media (max-width:768px){ .settings-container{grid-template-columns:1fr;} .form-row{grid-template-columns:1fr;} }
                /* Dark overrides piggyback on existing variable changes */
                [data-theme="dark"] .settings-info { background: var(--gradient-soft-start); color: var(--text); border-left-color: var(--primary-light); }
                [data-theme="dark"] .current-values { background: #202b21; border-color: var(--border-color); }
                [data-theme="dark"] .form-group input, [data-theme="dark"] .form-group textarea, [data-theme="dark"] .form-group select { background:#162218; border-color: var(--border-color); }
              </style>
            <input type="number" id="totalStudents" name="totalStudents" min="0" value="<%= (settings.site_stats && settings.site_stats.totalStudents) || 0 %>">
